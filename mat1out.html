<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudos: Probabilidade e Sequências (8º Ano)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* Cores principais atualizadas */
        .bg-dark-bg { background-color: #121212; } /* Fundo principal */
        .bg-dark-surface { background-color: #1E1E1E; } /* Cartões e nav */
        .text-dark-text { color: #E0E0E0; } /* Texto padrão */
        .text-dark-light-text { color: #B0B0B0; } /* Texto secundário/p */

        /* paleta de destaque: Tons de Bronze/Dourado Envelhecido */
        .accent-primary { background-color: #D97706; color: white; } /* Laranja escuro/Bronze (Orange 700) */
        .hover\:accent-primary-dark { background-color: #C26402; } /* Laranja mais escuro (Orange 800) */
        .accent-secondary { color: #FDBA74; } /* Laranja claro/Pêssego (Orange 300) */
        .text-highlight { color: #FED7AA; } /* Laranja mais claro (Orange 200) para destaques */
        .text-success { color: #34D399; } /* Esmeralda para sucesso */
        .bg-success-dark { background-color: #065F46; } /* Esmeralda mais escuro */
        .text-error { color: #EF4444; } /* Vermelho para erro */
        .bg-error-dark { background-color: #991B1B; } /* Vermelho mais escuro */
        
        .mode-button.active {
            background-color: #D97706; /* Cor principal de destaque */
            color: white;
        }
        .nav-link.active {
            background-color: #D97706; /* Cor principal de destaque */
            color: white;
        }

        .prose-headings {
            color: #FDBA74; /* Laranja claro (Orange 300) */
        }
        .prose-strong {
            color: #FDBA74; /* Laranja claro (Orange 300) */
        }
        .prose-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
            margin-bottom: 1em;
        }
        .prose-th, .prose-td {
            border: 1px solid #424242; /* Cinza mais escuro para bordas da tabela */
            padding: 0.5em 1em;
        }
        .prose-th {
            background-color: #2F2F2F; /* Fundo mais escuro para cabeçalho da tabela */
            font-weight: 600;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-dark-bg text-dark-text">

    <div class="w-full max-w-7xl mx-auto">
        <header class="text-center py-8 px-4">
            <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">Probabilidade e Sequências</h1>
            <p class="text-lg text-dark-light-text">Um guia sobre padrões, sequências e cálculo de chances (8º Ano).</p>
        </header>
        
        <nav class="flex justify-center items-center bg-dark-surface rounded-lg p-2 mb-8 gap-2 flex-wrap max-w-md mx-auto">
            <button id="btn-learn" class="mode-button accent-primary flex-grow sm:flex-grow-0 text-center py-2 px-4 rounded-md font-semibold transition-all duration-300 hover:accent-primary-dark">Aprender</button>
            <button id="btn-practice" class="mode-button flex-grow sm:flex-grow-0 text-center py-2 px-4 rounded-md font-semibold transition-all duration-300 hover:accent-primary-dark">Praticar</button>
        </nav>

        <div id="learn-container">
            <div class="flex flex-col lg:flex-row gap-8 p-4">
                <!-- Navegação Lateral --><aside class="lg:w-1/4">
                    <nav class="sticky top-4 bg-dark-surface rounded-lg p-4">
                        <h3 class="text-xl font-bold text-white mb-4">Tópicos</h3>
                        <ul class="space-y-2">
                            <li><a href="#sequencias" class="nav-link block py-2 px-4 rounded-md font-semibold transition-all duration-300 hover:accent-primary-dark active">1. Sequências Numéricas</a></li>
                            <li><a href="#probabilidade" class="nav-link block py-2 px-4 rounded-md font-semibold transition-all duration-300 hover:accent-primary-dark">2. Probabilidade</a></li>
                        </ul>
                    </nav>
                </aside>

                <!-- Conteúdo Principal --><main class="lg:w-3/4 space-y-12">
                    <section id="sequencias" class="bg-dark-surface p-6 sm:p-8 rounded-lg shadow-lg">
                        <article class="prose prose-invert max-w-none text-dark-light-text">
                            <h2 class="text-3xl font-bold border-b border-gray-700 pb-2 mb-4 prose-headings">1. Sequências Numéricas</h2>
                            
                            <p><strong class="prose-strong">Sequências</strong> (ou Sucessões) são listas de números, figuras ou objetos que seguem uma <strong class="text-highlight">ordem</strong> ou um <strong class="text-highlight">padrão</strong> (uma regra).</p>
                            <p>Cada item da lista é chamado de <strong class="prose-strong">termo</strong>.</p>
                            
                            <h3 class="text-2xl font-semibold mt-6">Tipos de Sequências (Lei de Formação)</h3>
                            <p>A "lei de formação" é a regra que nos permite encontrar os próximos termos da sequência.</p>

                            <h4 class="text-xl font-semibold mt-4">Sequências Recursivas (ou Recorrentes)</h4>
                            <p>São sequências em que um termo depende <strong class="text-highlight">do termo anterior</strong> (ou dos termos anteriores) para ser formado.</p>
                            <ul>
                                <li><strong>Exemplo (Somar 3):</strong> (2, 5, 8, 11, 14, ...)
                                    <ul>
                                        <li>O primeiro termo é 2.</li>
                                        <li>A regra é: "Pegue o termo anterior e some 3".</li>
                                        <li>O próximo termo será 14 + 3 = 17.</li>
                                    </ul>
                                </li>
                                <li><strong>Exemplo (Sequência de Fibonacci):</strong> (1, 1, 2, 3, 5, 8, 13, ...)
                                    <ul>
                                        <li>Os dois primeiros termos são 1.</li>
                                        <li>A regra é: "Some os dois termos anteriores".</li>
                                        <li>(1+1=2), (1+2=3), (2+3=5), (3+5=8), ...</li>
                                        <li>O próximo termo será 8 + 13 = 21.</li>
                                    </ul>
                                </li>
                            </ul>

                            <h4 class="text-xl font-semibold mt-4">Sequências Não Recursivas (ou Não Recorrentes)</h4>
                            <p>São sequências em que cada termo depende apenas da sua <strong class="text-highlight">posição (n)</strong> na lista. Você não precisa saber o termo anterior para calcular o próximo.</p>
                            <ul>
                                <li><strong>Exemplo (Múltiplos de 5):</strong> (5, 10, 15, 20, 25, ...)
                                    <ul>
                                        <li>A regra (lei de formação) é: <strong class="text-highlight">Termo = 5 × n</strong> (onde 'n' é a posição).</li>
                                        <li>Posição 1 (n=1): 5 × 1 = 5</li>
                                        <li>Posição 2 (n=2): 5 × 2 = 10</li>
                                        <li>Posição 6 (n=6): 5 × 6 = 30. (Não precisei do termo 25 para achar o 30).</li>
                                    </ul>
                                </li>
                                <li><strong>Exemplo (Quadrados Perfeitos):</strong> (1, 4, 9, 16, 25, ...)
                                    <ul>
                                        <li>A regra é: <strong class="text-highlight">Termo = n²</strong> (ou n × n).</li>
                                        <li>Posição 1 (n=1): 1² = 1</li>
                                        <li>Posição 2 (n=2): 2² = 4</li>
                                        <li>Posição 6 (n=6): 6² = 36.</li>
                                    </ul>
                                </li>
                            </ul>
                        </article>
                    </section>
                    
                    <section id="probabilidade" class="bg-dark-surface p-6 sm:p-8 rounded-lg shadow-lg">
                        <article class="prose prose-invert max-w-none text-dark-light-text">
                            <h2 class="text-3xl font-bold border-b border-gray-700 pb-2 mb-4 prose-headings">2. Probabilidade</h2>
                            <p>A <strong class="prose-strong">Probabilidade</strong> é o ramo da matemática que estuda as <strong class="text-highlight">chances</strong> de um determinado resultado acontecer.</p>
                            
                            <h3 class="text-2xl font-semibold mt-6">Conceitos Básicos</h3>
                            <ul>
                                <li><strong>Experimento Aleatório:</strong> É qualquer ação que pode produzir resultados diferentes, mesmo se repetida da mesma forma (ex: jogar um dado, lançar uma moeda). Não sabemos o que vai sair, mas sabemos o que PODE sair.</li>
                                <li><strong>Espaço Amostral (S):</strong> É o conjunto de <strong class="text-highlight">TODOS os resultados possíveis</strong> de um experimento.
                                    <ul>
                                        <li>No lançamento de uma moeda: S = {Cara, Coroa} (2 resultados)</li>
                                        <li>No lançamento de um dado comum: S = {1, 2, 3, 4, 5, 6} (6 resultados)</li>
                                    </ul>
                                </li>
                                <li><strong>Evento (E):</strong> É o resultado (ou conjunto de resultados) que <strong class="text-highlight">eu quero que aconteça</strong>. É um subconjunto do espaço amostral.
                                    <ul>
                                        <li>Evento "Sair Cara": E = {Cara}</li>
                                        <li>Evento "Sair um número par" no dado: E = {2, 4, 6}</li>
                                    </ul>
                                </li>
                            </ul>

                            <h3 class="text-2xl font-semibold mt-6">Como Calcular a Probabilidade</h3>
                            <p>A probabilidade (P) de um evento (E) acontecer é a razão (divisão) entre o número de resultados que eu quero (casos favoráveis) e o número total de resultados possíveis (espaço amostral).</p>
                            <p class="text-center text-xl font-bold accent-secondary">P(E) = (Nº de Casos Favoráveis) / (Nº Total de Casos Possíveis)</p>
                            <p>O resultado pode ser expresso em fração, número decimal ou porcentagem.</p>

                            <h4 class="text-xl font-semibold mt-4">Exemplos</h4>
                            <ul>
                                <li><strong>Exemplo 1: Moeda</strong>
                                    <ul>
                                        <li>Qual a probabilidade de sair "Cara" ao lançar uma moeda?</li>
                                        <li>Casos Favoráveis (o que eu quero): {Cara} (1 caso)</li>
                                        <li>Casos Possíveis (total): {Cara, Coroa} (2 casos)</li>
                                        <li>P(Cara) = <strong class="text-highlight">1 / 2</strong> (ou 0,5 ou 50%)</li>
                                    </ul>
                                </li>
                                <li><strong>Exemplo 2: Dado</strong>
                                    <ul>
                                        <li>Qual a probabilidade de sair um número "maior que 4" ao lançar um dado?</li>
                                        <li>Casos Favoráveis: {5, 6} (2 casos)</li>
                                        <li>Casos Possíveis: {1, 2, 3, 4, 5, 6} (6 casos)</li>
                                        <li>P(maior que 4) = 2 / 6 = <strong class="text-highlight">1 / 3</strong> (ou 0,33... ou 33,3%)</li>
                                    </ul>
                                </li>
                                <li><strong>Exemplo 3: Urna</strong>
                                    <ul>
                                        <li>Uma urna tem 4 bolas azuis e 6 bolas vermelhas. Qual a probabilidade de sortear uma bola AZUL?</li>
                                        <li>Casos Favoráveis (Azul): 4 casos</li>
                                        <li>Casos Possíveis (Total de bolas): 4 + 6 = 10 casos</li>
                                        <li>P(Azul) = 4 / 10 = <strong class="text-highlight">2 / 5</strong> (ou 0,4 ou 40%)</li>
                                    </ul>
                                </li>
                            </ul>

                        </article>
                    </section>
                </main>
            </div>
        </div>
        
        <!-- Seção Praticar --><section id="practice-section" class="hidden p-4">
            <div id="quiz-container" class="bg-dark-surface p-6 sm:p-8 rounded-lg shadow-lg max-w-3xl mx-auto">
                <div id="question-header" class="mb-4 text-center">
                    <p class="accent-secondary font-semibold" id="question-topic"></p>
                </div>
                <p id="question-text" class="text-xl text-center mb-6 min-h-[60px]"></p>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div id="feedback-container" class="mt-6 text-center"></div>

                <!-- Navegação --><div class="flex justify-between items-center mt-8">
                    <button id="prev-btn" class="accent-primary py-2 px-5 rounded-md font-semibold transition-colors hover:accent-primary-dark disabled:bg-gray-600 disabled:cursor-not-allowed">Anterior</button>
                    <span id="question-counter" class="font-semibold text-dark-text"></span>
                    <button id="next-btn" class="accent-primary py-2 px-5 rounded-md font-semibold transition-colors hover:accent-primary-dark">Próxima</button>
                </div>
            </div>

            <!-- Navegação de Questões --><div id="question-nav-container" class="hidden bg-dark-surface p-4 rounded-lg shadow-lg max-w-3xl mx-auto mt-4">
                <div id="question-buttons-grid" class="flex flex-wrap justify-center gap-2">
                    <!-- Buttons will be programmatically inserted here --></div>
            </div>

             <!-- Tela de Pontuação --><div id="score-screen" class="hidden text-center bg-dark-surface p-8 rounded-lg shadow-lg max-w-3xl mx-auto mt-8">
                <h3 class="text-4xl font-bold text-white mb-4">Pontuação Final</h3>
                <p id="final-score" class="text-6xl font-bold accent-secondary mb-2"></p>
                <p id="score-message" class="text-lg text-dark-light-text mb-8"></p>
                <button id="restart-btn" class="bg-green-600 text-white py-3 px-8 rounded-lg font-semibold text-lg hover:bg-green-500 transition-colors">Recomeçar</button>
            </div>
        </section>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // --- BANCO DE DADOS DAS QUESTÕES ---
        const questions = [
            // NÍVEL FÁCIL (10 Questões)
            { topic: "Sequências", difficulty: "Fácil", question: "Qual o próximo termo da sequência (2, 4, 6, 8, ...)?", options: ["9", "10", "12", "16"], answer: 1, explanation: "É a sequência dos números pares, ou uma sequência recursiva que soma 2 ao termo anterior. 8 + 2 = 10." },
            { topic: "Sequências", difficulty: "Fácil", question: "Qual o próximo termo da sequência (5, 10, 15, 20, ...)?", options: ["21", "30", "25", "50"], answer: 2, explanation: "É a sequência dos múltiplos de 5, ou uma sequência recursiva que soma 5. 20 + 5 = 25." },
            { topic: "Sequências", difficulty: "Fácil", question: "Na sequência de Fibonacci (1, 1, 2, 3, 5, ...), qual o próximo termo?", options: ["6", "7", "8", "10"], answer: 2, explanation: "A regra de Fibonacci é somar os dois termos anteriores. O próximo termo é 3 + 5 = 8." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "O que é 'Espaço Amostral'?", options: ["O resultado que eu quero", "Apenas o primeiro resultado", "Todos os resultados possíveis", "Um experimento que falhou"], answer: 2, explanation: "Espaço Amostral (S) é o conjunto de TODOS os resultados possíveis de um experimento." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "O que é um 'Evento'?", options: ["O resultado que eu quero", "Todos os resultados possíveis", "A chance de ganhar", "A fórmula da probabilidade"], answer: 0, explanation: "Evento (E) é o resultado específico, ou conjunto de resultados, que eu quero que aconteça." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "Qual o espaço amostral de um lançamento de dado comum?", options: ["{1, 2, 3}", "{1, 2, 3, 4, 5, 6}", "{6}", "{Cara, Coroa}"], answer: 1, explanation: "O espaço amostral são todos os lados (resultados) possíveis de um dado: {1, 2, 3, 4, 5, 6}." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "Qual a probabilidade de tirar 'Cara' no lançamento de uma moeda?", options: ["1/2 (50%)", "1/1 (100%)", "1/3 (33,3%)", "0 (0%)"], answer: 0, explanation: "Casos Favoráveis (Cara) = 1. Casos Possíveis (Cara, Coroa) = 2. A probabilidade é 1/2." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "Qual a probabilidade de tirar o número '3' no lançamento de um dado?", options: ["1/3", "3/6", "1/6", "1/2"], answer: 2, explanation: "Casos Favoráveis (número 3) = 1. Casos Possíveis (1,2,3,4,5,6) = 6. A probabilidade é 1/6." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "Uma probabilidade de 100% (ou 1) significa que o evento é:", options: ["Impossível", "Pouco provável", "Certo (com certeza vai acontecer)", "Metade da chance"], answer: 2, explanation: "Probabilidade 1 (ou 100%) significa que o evento é certo. Ex: Tirar um número menor que 7 num dado." },
            { topic: "Probabilidade", difficulty: "Fácil", question: "Uma probabilidade de 0% (ou 0) significa que o evento é:", options: ["Impossível (nunca vai acontecer)", "Certo", "Provável", "Metade da chance"], answer: 0, explanation: "Probabilidade 0 significa que o evento é impossível. Ex: Tirar o número 8 num dado de 6 faces." },

            // NÍVEL MÉDIO (12 Questões)
            { topic: "Sequências", difficulty: "Médio", question: "Qual o próximo termo da sequência (1, 4, 9, 16, 25, ...)?", options: ["30", "32", "36", "49"], answer: 2, explanation: "É a sequência dos quadrados perfeitos (n²). 1²=1, 2²=4, 3²=9, 4²=16, 5²=25. O próximo é 6² = 36." },
            { topic: "Sequências", difficulty: "Médio", question: "Qual o próximo termo da sequência (40, 35, 30, 25, ...)?", options: ["20", "15", "10", "5"], answer: 0, explanation: "É uma sequência recursiva onde a regra é 'subtrair 5' do termo anterior. 25 - 5 = 20." },
            { topic: "Sequências", difficulty: "Médio", question: "Qual o próximo termo da sequência (3, 6, 12, 24, ...)?", options: ["30", "36", "48", "60"], answer: 2, explanation: "É uma sequência recursiva onde a regra é 'multiplicar por 2' o termo anterior. 24 × 2 = 48." },
            { topic: "Sequências", difficulty: "Médio", question: "A sequência (1, 1, 2, 3, 5, 8, ...) é um exemplo de sequência:", options: ["Não recursiva (n²)", "Recursiva (Fibonacci)", "Recursiva (Soma 2)", "Não recursiva (Múltiplos de 2)"], answer: 1, explanation: "É a Sequência de Fibonacci, um exemplo clássico de sequência recursiva (onde um termo depende dos dois anteriores)." },
            { topic: "Sequências", difficulty: "Médio", question: "A sequência (5, 10, 15, 20, ...) pode ser definida pela lei de formação não recursiva:", options: ["n + 5", "5 × n", "n² + 4", "n + 4"], answer: 1, explanation: "É a sequência dos múltiplos de 5. O termo na posição 'n' é dado por 5 × n." },
            { topic: "Probabilidade", difficulty: "Médio", question: "Ao lançar um dado, qual a probabilidade de sair um número PAR?", options: ["1/6", "2/6", "3/6 (1/2)", "4/6"], answer: 2, explanation: "Casos Favoráveis (Pares: 2, 4, 6) = 3. Casos Possíveis = 6. P = 3/6, que simplificando é 1/2." },
            { topic: "Probabilidade", difficulty: "Médio", question: "Ao lançar um dado, qual a probabilidade de sair um número MENOR que 3?", options: ["2/6 (1/3)", "3/6 (1/2)", "1/6", "4/6"], answer: 0, explanation: "Casos Favoráveis (Menores que 3: 1, 2) = 2. Casos Possíveis = 6. P = 2/6, que simplificando é 1/3." },
            { topic: "Probabilidade", difficulty: "Médio", question: "Uma urna tem 3 bolas brancas e 2 bolas pretas. Qual a P(Preta)?", options: ["1/5", "3/5", "2/3", "2/5"], answer: 3, explanation: "Casos Favoráveis (Preta) = 2. Casos Possíveis (Total de bolas) = 3 + 2 = 5. P = 2/5." },
            { topic: "Probabilidade", difficulty: "Médio", question: "No lançamento de um dado, qual a P(sair um número ímpar OU o número 2)?", options: ["1/6", "3/6 (1/2)", "4/6 (2/3)", "5/6"], answer: 2, explanation: "Casos Favoráveis (Ímpares: 1, 3, 5) + (o 2) = {1, 2, 3, 5} = 4 casos. Casos Possíveis = 6. P = 4/6 = 2/3." },
            { topic: "Probabilidade", difficulty: "Médio", question: "Uma urna tem 10 bolas numeradas de 1 a 10. Qual a P(sortear um múltiplo de 3)?", options: ["3/10", "4/10", "2/10", "1/10"], answer: 0, explanation: "Casos Possíveis = 10. Casos Favoráveis (Múltiplos de 3: 3, 6, 9) = 3. P = 3/10." },
            { topic: "Sequências", difficulty: "Médio", question: "Qual o 10º termo da sequência (n² + 1)?", options: ["101", "100", "21", "11"], answer: 0, explanation: "A lei é n² + 1. Para o 10º termo, n=10. (10)² + 1 = 100 + 1 = 101." },
            { topic: "Probabilidade", difficulty: "Médio", question: "Num baralho de 52 cartas, qual a P(tirar um 'Rei')?", options: ["1/52", "4/52 (1/13)", "13/52 (1/4)", "1/4"], answer: 1, explanation: "Existem 4 Reis (Copas, Ouros, Paus, Espadas). Casos Favoráveis = 4. Casos Possíveis = 52. P = 4/52, que simplificando é 1/13." },

            // NÍVEL DIFÍCIL (8 Questões)
            { topic: "Sequências", difficulty: "Difícil", question: "Qual o 8º termo da sequência (1, 3, 7, 15, 31, ...)?", options: ["63", "127", "255", "511"], answer: 2, explanation: "A regra recursiva é 'Dobrar o anterior e somar 1' (ou 2^n - 1). 31*2+1 = 63 (6º). 63*2+1 = 127 (7º). 127*2+1 = 255 (8º)." },
            { topic: "Sequências", difficulty: "Difícil", question: "Qual o primeiro termo NEGATIVO da sequência (50, 43, 36, 29, ...)?", options: ["-1", "-5", "-6", "-8"], answer: 3, explanation: "A regra é subtrair 7. 29, 22, 15, 8, 1. O próximo termo é 1 - 7 = -6. (Ops, corrigindo. 1-7 = -6. Deixe-me refazer: 29-7=22, 22-7=15, 15-7=8, 8-7=1, 1-7 = -6. A opção -6 está correta, mas a -8 não. Vou ajustar para a resposta ser -6.) (Revisão: A resposta -8 está nas opções. Vamos de novo. 29...22...15...8...1...-6...-13. O primeiro negativo é -6. A opção -8 está errada. Vamos assumir que a opção -6 é a correta.) (Nova revisão: O usuário verá as opções. 29, 22, 15, 8, 1, -6, -13. O primeiro negativo é -6. Vou escolher a opção -6.)", answer: 2, explanation: "A regra é subtrair 7. (50, 43, 36, 29, 22, 15, 8, 1, -6, ...). O primeiro termo negativo é -6." },
            { topic: "Probabilidade", difficulty: "Difícil", question: "Ao lançar DOIS dados, qual o espaço amostral (total de resultados)?", options: ["12", "6", "36", "24"], answer: 2, explanation: "São 6 possibilidades no primeiro dado E 6 no segundo. O total de combinações é 6 × 6 = 36." },
            { topic: "Probabilidade", difficulty: "Difícil", question: "Ao lançar DOIS dados, qual a P(a soma ser 7)?", options: ["1/36", "6/36 (1/6)", "7/36", "5/36"], answer: 1, explanation: "Casos Possíveis = 36. Casos Favoráveis (soma 7): (1,6), (6,1), (2,5), (5,2), (3,4), (4,3). São 6 casos. P = 6/36 = 1/6." },
            { topic: "Probabilidade", difficulty: "Difícil", question: "Ao lançar DOIS dados, qual a P(a soma ser 10)?", options: ["3/36 (1/12)", "2/36 (1/18)", "1/36", "4/36"], answer: 0, explanation: "Casos Possíveis = 36. Casos Favoráveis (soma 10): (4,6), (6,4), (5,5). São 3 casos. P = 3/36 = 1/12." },
            { topic: "Probabilidade", difficulty: "Difícil", question: "Uma urna tem 5 bolas vermelhas, 3 azuis e 2 verdes. Qual a P(NÃO tirar verde)?", options: ["2/10 (1/5)", "3/10", "5/10 (1/2)", "8/10 (4/5)"], answer: 3, explanation: "Total de bolas = 10. Casos Favoráveis (NÃO verde) = 5 Vermelhas + 3 Azuis = 8 casos. P = 8/10 = 4/5." },
            { topic: "Probabilidade", difficulty: "Difícil", question: "Numa classe com 15 meninos e 10 meninas, qual a P(sortear uma menina)?", options: ["10/15 (2/3)", "15/25 (3/5)", "10/25 (2/5)", "1/10"], answer: 2, explanation: "Casos Favoráveis (Meninas) = 10. Casos Possíveis (Total de alunos) = 15 + 10 = 25. P = 10/25 = 2/5." },
            { topic: "Probabilidade", difficulty: "Difícil", question: "Ao lançar duas moedas, qual a P(sair pelo menos UMA cara)?", options: ["1/4", "2/4 (1/2)", "3/4", "1/3"], answer: 2, explanation: "Espaço Amostral: {CC, CK, KC, KK} (4 casos). Evento 'Pelo menos uma cara': {CC, CK, KC} (3 casos). P = 3/4." }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // --- LÓGICA DO MODO DE APRENDIZAGEM ---
            const links = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('#learn-container main section');

            const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 }; // Ajustado para 0.1
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        links.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href').substring(1) === entry.target.id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => { observer.observe(section); });
            
            links.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });

            // --- LÓGICA DO MODO DE PRÁTICA ---
            const btnLearn = document.getElementById('btn-learn');
            const btnPractice = document.getElementById('btn-practice');
            const learnContainer = document.getElementById('learn-container');
            const practiceSection = document.getElementById('practice-section');
            
            const quizContainer = document.getElementById('quiz-container');
            const scoreScreen = document.getElementById('score-screen');
            const questionTopic = document.getElementById('question-topic');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const feedbackContainer = document.getElementById('feedback-container');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const questionCounter = document.getElementById('question-counter');
            const finalScore = document.getElementById('final-score');
            const scoreMessage = document.getElementById('score-message');
            const restartBtn = document.getElementById('restart-btn');
            const questionNavContainer = document.getElementById('question-nav-container');

            let state = {
                currentMode: 'learn',
                currentQuestionIndex: 0,
                userAnswers: [],
                score: 0,
            };

            function switchMode(mode) {
                state.currentMode = mode;
                btnLearn.classList.toggle('active', mode === 'learn');
                btnPractice.classList.toggle('active', mode !== 'learn');
                learnContainer.classList.toggle('hidden', mode !== 'learn');
                practiceSection.classList.toggle('hidden', mode === 'learn');

                if (mode === 'practice') {
                    startPractice();
                }
            }

            function startPractice() {
                state.currentQuestionIndex = 0;
                state.score = 0;
                state.userAnswers = Array(questions.length).fill(null);
                quizContainer.classList.remove('hidden');
                scoreScreen.classList.add('hidden');
                questionNavContainer.classList.remove('hidden');
                renderQuestionNavigation();
                renderQuestion(0);
            }
            
            function renderQuestion(index) {
                const question = questions[index];
                questionTopic.textContent = `${question.topic} - (Nível: ${question.difficulty})`;
                questionText.textContent = question.question;
                questionCounter.textContent = `${index + 1} / ${questions.length}`;

                optionsContainer.innerHTML = '';
                feedbackContainer.innerHTML = '';

                question.options.forEach((option, i) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = "w-full text-left p-4 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors disabled:cursor-not-allowed";
                    button.onclick = () => checkAnswer(i, question.answer, question.explanation);
                    optionsContainer.appendChild(button);
                });

                updateNavButtonsState();
                updateQuestionNavButtons();
            }

            function checkAnswer(selectedIndex, correctIndex, explanation) {
                const isCorrect = selectedIndex === correctIndex;
                const isFirstAttempt = state.userAnswers[state.currentQuestionIndex] === null;
                const wasPreviouslyWrong = state.userAnswers[state.currentQuestionIndex] === false;

                if (isFirstAttempt) {
                    state.userAnswers[state.currentQuestionIndex] = isCorrect; // Set state on first try
                    if (isCorrect) {
                        state.score++;
                        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    }
                } else if (wasPreviouslyWrong && isCorrect) {
                    // This is the user's request: was wrong, retried, now correct
                    state.userAnswers[state.currentQuestionIndex] = true; // Update state to correct
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); // Fire confetti on correction
                }

                Array.from(optionsContainer.children).forEach((btn, i) => {
                    btn.disabled = true;
                    if (i === correctIndex) {
                        btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                        btn.classList.add('bg-green-600', 'text-white');
                    } else if (i === selectedIndex) {
                        btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                        btn.classList.add('bg-red-600', 'text-white');
                    }
                });

                feedbackContainer.innerHTML = `
                    <div class="p-4 rounded-lg ${isCorrect ? 'bg-success-dark' : 'bg-error-dark'}">
                        <h4 class="font-bold text-lg mb-2">${isCorrect ? 'Resposta Correta!' : 'Resposta Incorreta!'}</h4>
                        <p class="text-sm">${explanation}</p>
                        <button id="redo-question-btn" class="mt-4 py-2 px-4 accent-primary rounded-md font-semibold hover:accent-primary-dark transition-colors">Tentar Novamente</button>
                    </div>`;
                
                // Adiciona o listener para o novo botão
                document.getElementById('redo-question-btn').addEventListener('click', resetCurrentQuestion);
                
                updateQuestionNavButtons();
            }
            
            function resetCurrentQuestion() {
                // Limpa o feedback
                feedbackContainer.innerHTML = '';
                
                // Re-abilita as opções e reseta os estilos
                Array.from(optionsContainer.children).forEach(btn => {
                    btn.disabled = false;
                    btn.className = "w-full text-left p-4 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors disabled:cursor-not-allowed";
                });
            }

            function updateNavButtonsState() {
                prevBtn.disabled = state.currentQuestionIndex === 0;
                nextBtn.textContent = (state.currentQuestionIndex === questions.length - 1) ? "Finalizar" : "Próxima";
            }

            function nextQuestion() {
                if (state.currentQuestionIndex < questions.length - 1) {
                    goToQuestion(state.currentQuestionIndex + 1);
                } else {
                    showFinalScore();
                }
            }

            function prevQuestion() {
                if (state.currentQuestionIndex > 0) {
                   goToQuestion(state.currentQuestionIndex - 1);
                }
            }

            function goToQuestion(index) {
                if (index >= 0 && index < questions.length) {
                    state.currentQuestionIndex = index;
                    renderQuestion(index);
                }
            }

            function renderQuestionNavigation() {
                const grid = document.getElementById('question-buttons-grid');
                grid.innerHTML = '';
                for (let i = 0; i < questions.length; i++) {
                    const button = document.createElement('button');
                    button.textContent = i + 1;
                    button.className = 'w-9 h-9 flex items-center justify-center rounded-md font-semibold transition-all duration-200';
                    button.dataset.index = i;
                    button.onclick = () => goToQuestion(i);
                    grid.appendChild(button);
                }
            }
            
            function updateQuestionNavButtons() {
                const buttons = document.querySelectorAll('#question-buttons-grid button');
                buttons.forEach((btn, i) => {
                    // Reset classes, keeping base styles
                    btn.className = 'w-9 h-9 flex items-center justify-center rounded-md font-semibold transition-all duration-200';

                    const answerState = state.userAnswers[i];
                    
                    if (answerState === true) {
                        btn.classList.add('bg-green-600', 'text-white');
                    } else if (answerState === false) {
                        btn.classList.add('bg-red-600', 'text-white');
                    } else {
                        btn.classList.add('bg-gray-700', 'hover:bg-gray-600');
                    }

                    if (i === state.currentQuestionIndex) {
                        btn.classList.add('ring-2', 'ring-offset-2', 'ring-offset-gray-800', 'ring-orange-500'); /* Alterado para ring-orange-500 */
                        btn.classList.remove('hover:bg-gray-600');
                    }
                });
            }
            
            function showFinalScore() {
                quizContainer.classList.add('hidden');
                scoreScreen.classList.remove('hidden');
                questionNavContainer.classList.add('hidden');

                const percentage = Math.round((state.score / questions.length) * 100);
                finalScore.textContent = `${percentage}%`;

                let message = '';
                if (percentage >= 90) message = "Excelente! Você dominou o assunto!";
                else if (percentage >= 70) message = "Muito bom! Continue praticando para aperfeiçoar.";
                else if (percentage >= 50) message = "Bom esforço! Reveja os tópicos que errou.";
                else message = "Não desanime! Reveja a seção 'Aprender' e tente novamente.";
                
                scoreMessage.textContent = `Você acertou ${state.score} de ${questions.length} questões. ${message}`;
            }

            // --- INICIALIZAÇÃO ---
            // Assegura que os botões de modo tenham a cor correta no início
            btnLearn.classList.add('active'); // Começa no modo 'learn'
            
            btnLearn.addEventListener('click', () => switchMode('learn'));
            btnPractice.addEventListener('click', () => switchMode('practice'));
            prevBtn.addEventListener('click', prevQuestion);
            nextBtn.addEventListener('click', nextQuestion);
            restartBtn.addEventListener('click', startPractice);

            // Garante que o estado inicial (learn) esteja correto
            switchMode('learn');
        });
    </script>
</body>
</html>
